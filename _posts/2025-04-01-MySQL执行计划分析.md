---
title: MySQL执行计划分析
date: 2025-04-01
categories: [数据库管理系统, MySQL]
tags: [MySQL]     # TAG names should always be lowercase
order: #文章顺序，可选
---

# 什么是执行计划

执行计划是数据库管理系统（如 MySQL、Oracle、SQL Server）为执行一条 SQL 语句而生成的 ​操作步骤和策略的详细说明。它描述了数据库如何访问数据、选择索引、连接表、过滤行等具体行为，相当于 SQL 查询的“执行路线图”。

通过分析执行计划可以进行
1. **性能优化**：定位慢查询的瓶颈（如全表扫描、未使用索引），
2. **索引验证**：检查索引是否被正确使用，避免冗余或低效索引
3. **成本估算**:数据库优化器会根据统计信息（如行数、索引分布）选择成本最低的执行路径。
4. **理解查询逻辑**：明确多表连接顺序、子查询处理方式等细节。

# EXPLAIN作用和使用技巧

EXPLAIN 语句用于分析 SQL 查询的执行计划，帮助开发者理解查询的执行方式和性能瓶颈。通过 EXPLAIN，可以查看查询的各个阶段、使用的索引、连接类型等信息。

> EXPLAIN 语句不会实际执行查询，只会返回执行计划信息。

## 语法
```sql
EXPLAIN [options] SELECT ...;
```

### 选项
- `FORMAT=TRADITIONAL`：传统格式，适用于大多数场景。
- `FORMAT=JSON`：JSON 格式，适用于需要进一步处理或分析的场景。
- `FORMAT=TREE`：树形格式，适用于需要可视化分析的场景。

### 示例
```sql
mysql> EXPLAIN SELECT id, age FROM user WHERE age = 25;
+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key     | key_len | ref   | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | user  | NULL       | ref  | idx_age       | idx_age | 5       | const |    2 |   100.00 | Using index |
+----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)
```

## EXPLAIN输出字段解析
- `id`：查询的序列号，表示执行顺序（相同 id 按从上到下执行，不同 id 按从大到小执行）。
- `select_type`：查询类型，表示查询的复杂程度和类型(简单查询,子查询,UNION等)。
- `table`：表示查询的表名或视图名。
- `partitions`：表示查询涉及的分区信息（如果使用了分区表,如果没有则为NULL）。
- `type`：访问类型
- `possible_keys`：表示可能使用的索引列表。
- `key`：表示实际使用的索引。
- `key_len`：表示使用的索引长度。
- `ref`：与索引匹配的列或常量。
- `rows`：表示估计扫描的行数,越小越好。
- `Extra`：额外信息

### 关键字段解析

#### 1. `type`
表示访问类型，反映了查询的效率。常见的类型从好到坏依次为：
- `system`：表只有一行（系统表），效率最高。
- `const`：表中最多只有一行匹配，使用主键或唯一索引查找，效率高。
- `eq_ref`：对于每个来自上表的行，最多有一行匹配下表的行，通常用于主键或唯一索引。
- `ref`：对于每个来自上表的行，可能有多行匹配下表的行，通常用于非唯一索引。
- `index_merge`：索引合并，表示使用了多个索引来满足查询条件。
- `range`：索引范围扫描，使用索引查找一个范围的值。
- `index`：全索引扫描，表示扫描了整个索引。
- `ALL`：全表扫描，效率最低。

#### 2. `Extra`

表示额外信息，提供了更多关于查询执行的细节。常见的值包括：
- `Using index`：表示查询只使用了索引，没有访问表数据，效率高。
- `Using where`：表示查询使用了 WHERE 子句过滤数据。
- `Using temporary`：表示查询使用了临时表，常见于`ORDER BY`和`GROUP BY`可能影响性能。
- `Using filesort`：表示查询使用了文件排序，没有使用索引排序，可能影响性能。
- `Using join buffer`：表示查询使用了连接缓冲区，可能影响性能。
- `Using index condition`：表示查询使用了索引条件下推，优化了查询性能。

# 参考
- [MySQL执行计划分析](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html)
